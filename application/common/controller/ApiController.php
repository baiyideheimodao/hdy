<?php
    /**
     *  Encoding : UTF-8
     *  Separator : Unix and OS X (\n)
     *  File Name : ApiController.php
     *  Create Date : 2021/12/2 17:27
     *  Version : 0.1
     *  Copyright : test-master Project Team Copyright (C)
     *  license http://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh
     */
    namespace app\common\controller;

    class ApiController extends BaseController  {

        protected function initialize() {
            parent::initialize(); // TODO: Change the autogenerated stub
            header('Access-Control-Allow-Origin: *');
            header('Access-Control-Allow-Headers: *');
        }

        /**
         * 统一返回
         * @param string $message
         * @param int    $states
         * @param array  $result
         * @param int    $page
         * @param int    $total
         * @param int    $perpage
         */
        public function rs($message = '', $states = 0, $result = [],$page = 1,$total = 0, $perpage = 10) {
            $return = [
                'state'   => urldecode($states),
                'message' => urldecode($message),
                'timestamp'   => time()
            ];
            // 如果有结果的话
            if (!empty($result)) {
                //当结果是一个对象，并且计算的总数大于0
                if (intval($total) >= 1) {
                    $results['data']                = json_decode(json_encode($result), true);
                    $results['currentpage'] = $page;
                    $results['pagesize']    = $perpage;
                    $results['showrefresh'] = !(intval(ceil($total / $perpage)) == $page);
                    $results['totalpage']   = intval(ceil($total / $perpage));
                    $return['listdata']    = $results;
                }else{
                    if (is_array($result)) {
                        $return['data'] = $result;
                        $result['showrefresh'] = false;
                    }
                }
            }
            die(json_encode($return));
        }


    }